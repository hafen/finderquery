<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Building Queries • finderquery</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Building Queries">
<meta property="og:description" content="finderquery">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">finderquery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/app.html">Application Interface and API</a>
    </li>
    <li>
      <a href="../articles/usage.html">Building Queries</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Building Queries</h1>
            
      
      
      <div class="hidden name"><code>usage.Rmd</code></div>

    </div>

    
    
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>To install the version of finderquery described in this documentation, do the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes") # if not already installed</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"hafen/finderquery@updates"</span><span class="op">)</span></code></pre></div>
</div>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>The first thing to do is to establish a connection with the Finder server by specifying its IP address and optionally the port. In our case, it is stored in an environment variable <code>FINDER_IP</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">finderquery</span><span class="op">)</span>

<span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/finder_connect.html">finder_connect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"FINDER_IP"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This connection object is passed to queries so it knows where to go to run the query. Note that calling <code><a href="../reference/finder_connect.html">finder_connect()</a></code> does not actually initiate a connection. It only stores an object that tells future queries where to go to run.</p>
<p>Note that if you are working in an R console on some machines, you may need to run the following for the Solr server to be reachable:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.unsetenv</a></span><span class="op">(</span><span class="st">"NO_PROXY"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.unsetenv</a></span><span class="op">(</span><span class="st">"HTTPS_PROXY"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.unsetenv</a></span><span class="op">(</span><span class="st">"HTTP_PROXY"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.unsetenv</a></span><span class="op">(</span><span class="st">"https_proxy"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.unsetenv</a></span><span class="op">(</span><span class="st">"http_proxy"</span><span class="op">)</span></code></pre></div>
</div>
<div id="queries" class="section level1">
<h1 class="hasAnchor">
<a href="#queries" class="anchor"></a>Queries</h1>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Two major types of queries are currently supported by this package.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Fetch</strong>: Documents are retrieved according to specified criteria, query initiated with <code><a href="../reference/fq_query_fetch.html">fq_query_fetch()</a></code>
</li>
<li>
<strong>Facet</strong>: Documents are counted by specified fields in the data, query initiated with <code><a href="../reference/fq_query_facet.html">fq_query_facet()</a></code>
</li>
</ol>
<p>After a query is initiated, it can built upon by piping various operations:</p>
<ul>
<li>
<code>fq_filter_*()</code>: filter on specified values of a field (*), for both fetch and facet queries</li>
<li>
<code><a href="../reference/fq_select_fields.html">fq_select_fields()</a></code>: specify fields to select in the returned documents, only for fetch queries</li>
<li>
<code><a href="../reference/fq_sort_by.html">fq_sort_by()</a></code>: specify field by which to sort the returned documents, only for fetch queries.</li>
<li>
<code><a href="../reference/fq_facet_by.html">fq_facet_by()</a></code>: specify a field to facet by, only for facet queries</li>
<li>
<code><a href="../reference/fq_facet_date_range.html">fq_facet_date_range()</a></code>: specify a date range facet, only for facet queries</li>
</ul>
</div>
<div id="fetch-queries" class="section level2">
<h2 class="hasAnchor">
<a href="#fetch-queries" class="anchor"></a>Fetch queries</h2>
<p>Fetch queries simply retrieve documents based on filtering criteria.</p>
<div id="initiating-a-query" class="section level3">
<h3 class="hasAnchor">
<a href="#initiating-a-query" class="anchor"></a>Initiating a query</h3>
<p>A fetch query is initialized using <code><a href="../reference/fq_query_fetch.html">fq_query_fetch()</a></code>, which takes as its primary argument the connection object.</p>
<p>Additonal arguments include:</p>
<ul>
<li>
<code>max</code>: The maximum number of documents to return. The default is 10. If set to <code>-1</code>, the total number of documents that match the query parameters will be returned. Often it is good to run a query with the default value of <code>max</code> or even <code>max = 0</code> to get a feel for how many documents are in the query before deciding to pull the full set of documents. Even when <code>max = 0</code> is set, the query result will include an indication of the total number of documents in the query. An example of this will be shown below. Setting <code>max = -1</code> (or anything less than 0) will result in all documents being pulled.</li>
<li>
<code>format</code>: One of “list”, “xml”, or “file”. The default is “list”, in which case the documents are read into memory and converted to a more R-convenient list format. If “xml”, the documents will be read into R and returned as an xml2 “xml_document” object. If “file”, the xml file(s) will simply be downloaded and the path to the directory containing these files will be returned. Note that if <code>max = -1</code> and <code>format</code> is not “file”, it will be forced to “file” (and a temporary directory will be used if not specified) since the number of documents returned could potentially be very large. After pulling all the documents, if the number of documents is small enough to read into memory in a manageable way (currently set at &lt;=100k documents), the original <code>format</code> specification will be honored.</li>
<li>
<code>path</code>: If <code>format = "file"</code>, the path for where to store the downloaded xml files can be specified. If not specified, a temporary directory will be used. The specified path should ideally be empty.</li>
<li>
<code>size</code>: The number of documents to pull in each batch of pagination (see note below on pagination). The default is 10,000, which is the maximum allowed by Solr.</li>
</ul>
<p><strong>Note</strong>: Fetch queries automatically take care of <a href="https://lucene.apache.org/solr/guide/6_6/pagination-of-results.html">pagination</a> using cursors to retrieve potentially very large sets of documents. The pagination limit is 10k documents, so iterative queries are run to fetch these in batches and piece them together upon retrieval.</p>
<p>Initiating an “empty” query is as easy as the following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qry</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></code></pre></div>
<p>The query can be built upon by passing the <code>qry</code> object to other functions such as the <code>fq_filter_*()</code> functions to further refine the query.</p>
<p>At any point when constructing a query, the query object can either be passed to: - <code><a href="../reference/fq_get_query.html">fq_get_query()</a></code>: prints out a Solr API call that can be inspected or pasted in a web browser to retrieve the results - <code><a href="../reference/fq_run.html">fq_run()</a></code>: runs the query and returns the documents in the specified <code>format</code></p>
<p>To see our simple query:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_get_query.html">fq_get_query</a></span><span class="op">(</span><span class="va">qry</span><span class="op">)</span>
<span class="co">#&gt; [1] "op=search&amp;q=*:*&amp;rows=10"</span></code></pre></div>
<p>To run it:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="va">qry</span><span class="op">)</span></code></pre></div>
<p>As stated earlier, by default the returned object is an R-friendly list. The structure is one list element per document:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 10</span>
<span class="co">#&gt;  $ :List of 13</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "ecuadorenvivo-031d3f5dd16162472d0c4726887f69c1"</span>
<span class="co">#&gt;  $ :List of 14</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "ndr-128df0ba5b42818a59251419a7e17f64"</span>
<span class="co">#&gt;  $ :List of 15</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "ndr-138d21d990ff5b41d1f9247b0d1dea97"</span>
<span class="co">#&gt;  $ :List of 15</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "ndr-927a20c1c73d32a0c5f49b14064e2e4f"</span>
<span class="co">#&gt;  $ :List of 13</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "ndr-9b95c471e05bd7783c9253fc8e3637b9"</span>
<span class="co">#&gt;  $ :List of 12</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "ndr-1c2a88c3fae62353e26b862a4706a0a3"</span>
<span class="co">#&gt;  $ :List of 14</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "ndr-299d9142b0b5a72ba7a6496d3d4fccc8"</span>
<span class="co">#&gt;  $ :List of 15</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "deutschewelle-ro-72795b85ad41330a95a633210156a25c"</span>
<span class="co">#&gt;   ..- attr(*, "duplicate")= chr "deutschewelle-sq-72795b85ad41330a95a633210156a25c"</span>
<span class="co">#&gt;  $ :List of 15</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "deutschewelle-ro-f4fd8c657065e830055b0397da119ea9"</span>
<span class="co">#&gt;   ..- attr(*, "duplicate")= chr "deutschewelle-sr-f4fd8c657065e830055b0397da119ea9"</span>
<span class="co">#&gt;  $ :List of 16</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "cleantechnica-d2dd2e280252de07a4524aad60621ffd"</span>
<span class="co">#&gt;  - attr(*, "class")= chr [1:2] "finder_docs" "list"</span>
<span class="co">#&gt;  - attr(*, "meta")=List of 6</span></code></pre></div>
<p>The number of fields in a document varies per document, depending on its content. To look at the structure of the first document:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; List of 13</span>
<span class="co">#&gt;  $ title      :List of 2</span>
<span class="co">#&gt;  $ link       :List of 1</span>
<span class="co">#&gt;  $ description:List of 2</span>
<span class="co">#&gt;  $ contentType:List of 1</span>
<span class="co">#&gt;  $ pubDate    :List of 1</span>
<span class="co">#&gt;  $ source     :List of 1</span>
<span class="co">#&gt;   ..- attr(*, "url")= chr "http://www.ecuadorenvivo.com/index.php?format=feed&amp;type=rss"</span>
<span class="co">#&gt;   ..- attr(*, "country")= chr "EC"</span>
<span class="co">#&gt;  $ language   :List of 1</span>
<span class="co">#&gt;  $ guid       :List of 1</span>
<span class="co">#&gt;  $ category   :List of 2</span>
<span class="co">#&gt;  $ favicon    :List of 1</span>
<span class="co">#&gt;  $ georss     :List of 1</span>
<span class="co">#&gt;   ..- attr(*, "name")= chr "Guayaquil:Guayaquil:Guayas:Ecuador"</span>
<span class="co">#&gt;   ..- attr(*, "id")= chr "16913475"</span>
<span class="co">#&gt;   ..- attr(*, "lat")= chr "-2.20382"</span>
<span class="co">#&gt;   ..- attr(*, "lon")= chr "-79.8975"</span>
<span class="co">#&gt;   ..- attr(*, "count")= chr "2"</span>
<span class="co">#&gt;   ..- attr(*, "pos")= chr "72,256"</span>
<span class="co">#&gt;   ..- attr(*, ".class")= chr "2"</span>
<span class="co">#&gt;   ..- attr(*, "iso")= chr "EC"</span>
<span class="co">#&gt;   ..- attr(*, "charpos")= chr "72,256"</span>
<span class="co">#&gt;   ..- attr(*, "wordlen")= chr "9,9"</span>
<span class="co">#&gt;  $ tonality   :List of 1</span>
<span class="co">#&gt;  $ text       :List of 1</span>
<span class="co">#&gt;   ..- attr(*, "wordCount")= chr "188"</span>
<span class="co">#&gt;  - attr(*, "id")= chr "ecuadorenvivo-031d3f5dd16162472d0c4726887f69c1"</span></code></pre></div>
<p>Note that the structure of returned documents is difficult to flatten to a tabular format. Most fields can appear a variable number of times. Such as the title for this first document, for example.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">title</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "Solucionan problema de acumulación de aguas en Pascuales | Municipio de Guayaquil"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "Solve problem of water cumulation Pascuales' municipality of Guayaquil"</span>
<span class="co">#&gt; attr(,"lang")</span>
<span class="co">#&gt; [1] "en"</span></code></pre></div>
<p>In addition to fields appearing an unpredictable number of times, they also have attributes that are often important to preserve, but are not always predictable. In this case there is an attribute indicating that the second title is an english translation. Preserving attributes also makes flattening more difficult.</p>
<p>Recall that the default fetch query returns 10 documents. We can see how many total documents match the query parameters by using a convenience function <code><a href="../reference/fq_n_docs.html">fq_n_docs()</a></code> on our output:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_n_docs.html">fq_n_docs</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">#&gt; 9004209</span></code></pre></div>
</div>
<div id="adding-filters-to-fetch-queries" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-filters-to-fetch-queries" class="anchor"></a>Adding filters to fetch queries</h3>
<p>It is probably more desirable for a fetch query to pinpoint records of interest rather than to retrieve all documents. This can be done by adding filters to the query.</p>
<p>Filtering is added by filter functions specified for each filterable field, each of which begins with <code>fq_filter_</code> and ends with the field name being filtered.</p>
<p>The following sections illustrate examples of all of the available filters in thsi package.</p>
<p><strong>Note</strong> that filters can apply to both fetch and facet queries.</p>
<div id="term-filters" class="section level4">
<h4 class="hasAnchor">
<a href="#term-filters" class="anchor"></a>Term filters</h4>
<p>Several fields in the data are categorical and can be filtered based on a specified term or set of terms. These are case insensitive.</p>
<div id="fq_filter_category" class="section level5">
<h5 class="hasAnchor">
<a href="#fq_filter_category" class="anchor"></a><code>fq_filter_category()</code>
</h5>
<p><code><a href="../reference/fq_filter_category.html">fq_filter_category()</a></code> allows you to filter on the <code>category</code> document field.</p>
<p>Note that is convenient to build queries using the “pipe” (“<code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>”) operator, which allows us to string together multiple commands, including <code><a href="../reference/fq_run.html">fq_run()</a></code> at the end to run the query.</p>
<p>Here we filter to documents that contain the “CoronavirusInfection” category.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To see a list of category values that exist in the data:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fq_valid_categories.html">fq_valid_categories</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "abrin"           "acaricides"      "acinetobacter"   "acremonium"     </span>
<span class="co">#&gt; [5] "acrolein"        "acrylamidfurans"</span></code></pre></div>
<p>If you specify a vector of terms, all documents will be selected that match any of the provided values (OR logic). For example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span>, <span class="st">"PAHO"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>If you would like to exclude a term you can prepend it with “-” or “!”. For example, if we want to filter to documents that contain the category “CoronavirusInfection” but NOT the category “PAHO”:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span>, <span class="st">"-PAHO"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We can use any valid Solr specification of term combinations. For example, for documents that contain the category “CoronavirusInfection” AND the category “PAHO”:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection AND PAHO"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="fq_filter_country" class="section level5">
<h5 class="hasAnchor">
<a href="#fq_filter_country" class="anchor"></a><code>fq_filter_country()</code>
</h5>
<p>To filter on documents for which the source comes from Germany or France:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_country.html">fq_filter_country</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"de"</span>, <span class="st">"fr"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Note that when you specify a vector of values, it matches documents where <em>any</em> of those terms are found.</p>
<p>To see a list of country values that exist in the data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fq_valid_countries.html">fq_valid_countries</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "ad" "ae" "af" "ag" "ai" "al"</span></code></pre></div>
</div>
<div id="fq_filter_language" class="section level5">
<h5 class="hasAnchor">
<a href="#fq_filter_language" class="anchor"></a><code>fq_filter_language()</code>
</h5>
<p>We can use <code><a href="../reference/fq_filter_language.html">fq_filter_language()</a></code> to filter on languages in the documents:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_language.html">fq_filter_language</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"de"</span>, <span class="st">"fr"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To see a list of language values that exist in the data:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fq_valid_languages.html">fq_valid_languages</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "af" "am" "ar" "az" "be" "bg"</span></code></pre></div>
</div>
<div id="fq_filter_source" class="section level5">
<h5 class="hasAnchor">
<a href="#fq_filter_source" class="anchor"></a><code>fq_filter_source()</code>
</h5>
<p>To filter on the document source, source we can use <code><a href="../reference/fq_filter_source.html">fq_filter_source()</a></code>.</p>
<p>Here, we filter on documents with source “bbc<em>", where the "</em>” is a wildcard.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_source.html">fq_filter_source</a></span><span class="op">(</span><span class="st">"bbc*"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>To inspect the actual sources returned:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">source</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "bbc-swahili"           "bbc-health-html"       "bbc-spanish"          </span>
<span class="co">#&gt; [4] "bbc-portuguese-brasil" "bbcnepalirss"          "bbc-turkce" </span></code></pre></div>
<p>To see a list of source values that exist in the data:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fq_valid_sources.html">fq_valid_sources</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "055firenze"       "100noticias"      "10minuta"         "112-utrecht"</span>
<span class="co">#&gt; [5] "112achterhoek"    "112brabantnieuws"</span></code></pre></div>
</div>
<div id="fq_filter_duplicate" class="section level5">
<h5 class="hasAnchor">
<a href="#fq_filter_duplicate" class="anchor"></a><code>fq_filter_duplicate()</code>
</h5>
<p>We can filter on whether the document is flagged as a duplicate or not with <code><a href="../reference/fq_filter_duplicate.html">fq_filter_duplicate()</a></code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_duplicate.html">fq_filter_duplicate</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Duplicate is either <code>true</code> or <code>false</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/fq_valid_duplicate.html">fq_valid_duplicate</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "false" "true" </span></code></pre></div>
</div>
<div id="generic-term-field-filters" class="section level5">
<h5 class="hasAnchor">
<a href="#generic-term-field-filters" class="anchor"></a>Generic term field filters</h5>
<p>The <code>fq_filter_*()</code> functions described in this section are provided to help users create queries that do not contain errors, providing term filters the known available fields. However, as the Finder database evolves, or as different versions of the Finder database are used, there may be additional fields for which users would like to be able to define filters on. For this case, a function, <code><a href="../reference/fq_term_filter.html">fq_term_filter()</a></code> has been provided. This allows you to specify the field name you would like to apply a term filter to. Note that using this function incorrectly (referencing a field that doesn’t exist or can’t be filtered as a term filter) will result in query errors.</p>
<p>As an example, let’s run the most recent query using <code><a href="../reference/fq_term_filter.html">fq_term_filter()</a></code>. To do this:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_term_filter.html">fq_term_filter</a></span><span class="op">(</span><span class="st">"duplicate"</span>, <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>If you would like to add a special term filter function for a new field, you can update the R/filter.R file in the package source code based on the contents of other specific term filter functions.</p>
</div>
</div>
<div id="text-filter" class="section level4">
<h4 class="hasAnchor">
<a href="#text-filter" class="anchor"></a>Text filter</h4>
<p>The <code><a href="../reference/fq_filter_text.html">fq_filter_text()</a></code> function allows you to specify strings or a vector of strings to search for in the document’s title, description, and document text, including translations.</p>
<p>Below are some examples of using <code><a href="../reference/fq_filter_text.html">fq_filter_text()</a></code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># having word matching either "european" or "commision"</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_text.html">fq_filter_text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"european"</span>, <span class="st">"commission"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># having a word starting with "euro"</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_text.html">fq_filter_text</a></span><span class="op">(</span><span class="st">"euro*"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># having a word that matches "euro?ean" (question mark is single wild card)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_text.html">fq_filter_text</a></span><span class="op">(</span><span class="st">"euro?ean"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># having word that sounds like "europese" (with default edit distance 2)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_text.html">fq_filter_text</a></span><span class="op">(</span><span class="st">"europese~"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># having word that sounds like "Europian" (with edit distance 1)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_text.html">fq_filter_text</a></span><span class="op">(</span><span class="st">"Europian~1"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="generic-text-filter" class="section level5">
<h5 class="hasAnchor">
<a href="#generic-text-filter" class="anchor"></a>Generic text filter</h5>
<p><code><a href="../reference/fq_filter_text.html">fq_filter_text()</a></code> is designed to have a simple syntax. It constructs the <code>q=...</code> part of the query string based on simple inputs. If you have a much more custom <code>q=...</code> query that you would like to specify explicitly, you can use a special function, <code><a href="../reference/fq_q.html">fq_q()</a></code>.</p>
<p>For example,</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_q.html">fq_q</a></span><span class="op">(</span><span class="st">"+( 
(
+{!babel t=\"(health healthcare \\\"health care\\\" \\\"health-care\\\" medical)\"}
+{!babel t=\"(specialist* provider* professional* practitioner* doctor* worker* personnel staff)\"}
)
{!babel t=\"(physician* \\\"general practitioner\\\" therapist* nurse* midwife* caregiver* \\\"care provider\\\" gastroenterologist* surgeon* dentist* psychiatrist* pharmacist* ophthalmologist* cardiologist* anaesthesiologist* anesthesiologist* dermatologist* endocrinologist* geriatrician* haematologist*  hematologist* nephrologist* neurologist* oncologist* otolaryngologist* pulmonologist* paediatrician* pediatrician* radiologist* urologist*)\"}
)"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="date-filters" class="section level4">
<h4 class="hasAnchor">
<a href="#date-filters" class="anchor"></a>Date filters</h4>
<p>Two date filter functions are available, <code><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate()</a></code> and <code><a href="../reference/fq_filter_indexdate.html">fq_filter_indexdate()</a></code>, which filter on the publication date and indexed date, respectively.</p>
<p>These functions have arguments <code>from</code> and <code>to</code> which take a “Date” or “POSIXct” as input. If left unspecified, the filter will be open-ended on that side of the range. Instead of specifying a range, you can also specify <code>on</code> to get all articles on a specific day.</p>
<p>The example below queries all documents in German that have category “CoronavirusInfection” that were published in the last two days:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_language.html">fq_filter_language</a></span><span class="op">(</span><span class="st">"de"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Note here that we are stringing multiple filter commands together to get to what we are looking for. You can string as many filters together as you wish, but note that if you apply the same filter twice, the second one will override the first.</p>
<div id="generic-date-filter" class="section level5">
<h5 class="hasAnchor">
<a href="#generic-date-filter" class="anchor"></a>Generic date filter</h5>
<p>Similar to the generic term filter function <code><a href="../reference/fq_term_filter.html">fq_term_filter()</a></code> described above, there is also a generic date filter function <code><a href="../reference/fq_date_filter.html">fq_date_filter()</a></code>, which operates in a similar way and based on a similar premise of the possibility of the database having date fields in addition to the date fields we provide specific functions for.</p>
<p>For example, to filter on pubdate using <code><a href="../reference/fq_date_filter.html">fq_date_filter()</a></code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_date_filter.html">fq_date_filter</a></span><span class="op">(</span><span class="st">"pubdate"</span>, from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="other-filters" class="section level4">
<h4 class="hasAnchor">
<a href="#other-filters" class="anchor"></a>Other filters</h4>
<p>A few other filter functions are available.</p>
<div id="fq_filter_tonality" class="section level5">
<h5 class="hasAnchor">
<a href="#fq_filter_tonality" class="anchor"></a><code>fq_filter_tonality()</code>
</h5>
<p><code><a href="../reference/fq_filter_tonality.html">fq_filter_tonality()</a></code> is a special range filter that takes numeric values. In addition to having <code>from</code> and <code>to</code> parameters that behave in the same way as the date range filters, it also has a <code>value</code> parameter which can be used to retrive documents with a specific tonality value.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_tonality.html">fq_filter_tonality</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">tonality</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "4" "4" "4" "4" "4" "4" "4" "4" "4" "4"</span>


<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_tonality.html">fq_filter_tonality</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">tonality</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "12" "12" "8"  "23" "6"  "14" "9"  "4"  "4"  "10"</span></code></pre></div>
</div>
<div id="id-filters" class="section level5">
<h5 class="hasAnchor">
<a href="#id-filters" class="anchor"></a>ID filters</h5>
<p>Additional filters exist to filter on various IDs: <code><a href="../reference/fq_filter_entityid.html">fq_filter_entityid()</a></code>, <code><a href="../reference/fq_filter_georssid.html">fq_filter_georssid()</a></code>, <code><a href="../reference/fq_filter_guid.html">fq_filter_guid()</a></code>.</p>
<p>Below is an example of filtering on guid:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_guid.html">fq_filter_guid</a></span><span class="op">(</span><span class="st">"washtimes-*"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">guid</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "washtimes-91e4808dcddb198e95b7583fdb162225"</span>
<span class="co">#&gt; [2] "washtimes-b1f724b70e57280dbd42ed82763fb341"</span>
<span class="co">#&gt; [3] "washtimes-3ddcef4e8631e60586391695c43a82ac"</span>
<span class="co">#&gt; [4] "washtimes-7a44cd4213b3a663664da786b1242a38"</span>
<span class="co">#&gt; [5] "washtimes-73daa638c1adafe89815c7c3f0c42e06"</span></code></pre></div>
</div>
</div>
</div>
<div id="specifying-fields-to-sort-on" class="section level3">
<h3 class="hasAnchor">
<a href="#specifying-fields-to-sort-on" class="anchor"></a>Specifying fields to sort on</h3>
<p>Another operation available only for fetch queries is <code>sort_docs()</code>, which allows you to specify fields to sort by as part of the fetch.</p>
<p>For example, here we run a query similar to one shown earlier where we additionaly sort the results by date of publication.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_language.html">fq_filter_language</a></span><span class="op">(</span><span class="st">"de"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_sort_by.html">fq_sort_by</a></span><span class="op">(</span><span class="st">"pubdate"</span>, asc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">res</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">pubDate</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  [1] "2020-09-12T21:40+0000" "2020-09-12T21:40+0000" "2020-09-12T21:40+0000"</span>
<span class="co">#&gt;  [4] "2020-09-12T21:39+0000" "2020-09-12T21:35+0000" "2020-09-12T21:35+0000"</span>
<span class="co">#&gt;  [7] "2020-09-12T21:32+0000" "2020-09-12T21:32+0000" "2020-09-12T21:31+0000"</span>
<span class="co">#&gt; [10] "2020-09-12T21:30+0000"</span></code></pre></div>
<p>To see what fields are available to sort on:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_queryable_fields.html">fq_queryable_fields</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  [1] "language"      "category"      "country"       "source"       </span>
<span class="co">#&gt;  [5] "quotecategory" "duplicate"     "tonality"      "entityid"     </span>
<span class="co">#&gt;  [9] "guid"          "indexdate"     "pubdate"       "quotetext"    </span>
<span class="co">#&gt; [13] "text"          "quotewho"      "quoteabout"    "georssid"</span></code></pre></div>
</div>
<div id="specifying-fields-to-return" class="section level3">
<h3 class="hasAnchor">
<a href="#specifying-fields-to-return" class="anchor"></a>Specifying fields to return</h3>
<p>An operation available only for fetch queries, <code><a href="../reference/fq_select_fields.html">fq_select_fields()</a></code>, allows us to specify which fields should be returned for each document. This is useful if documents contain some fields that are very large and we don’t want to include them in our results.</p>
<p>Note that, to our knowledge, Finder does not provide a way to specify these fields at the time the query is run, so all fields are returned by the query and then fields are removed after being fetched. This means that there are not performance gains in terms of network transfer time, but there are gains in final file size.</p>
<p>To see what values are acceptable for a selectable field:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_selectable_fields.html">fq_selectable_fields</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  [1] "category"    "contentType" "description" "enclosure"   "entity"     </span>
<span class="co">#&gt;  [6] "favicon"     "fullgeo"     "georss"      "guid"        "keyword"    </span>
<span class="co">#&gt; [11] "language"    "link"        "location"    "pubDate"     "quote"      </span>
<span class="co">#&gt; [16] "relevance"   "source"      "text"        "title"       "tonality"   </span>
<span class="co">#&gt; [21] "translate"</span></code></pre></div>
<p>Note that these do not exactly match the fields that we can filter on. What is represented in a document vs. what is exposed by Finder to query on are not necessarily the same thing.</p>
<p>Suppose we have our same query as before, but we only want to pull out the document title and publication date:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_language.html">fq_filter_language</a></span><span class="op">(</span><span class="st">"de"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_sort_by.html">fq_sort_by</a></span><span class="op">(</span><span class="st">"pubdate"</span>, asc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_select_fields.html">fq_select_fields</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"title"</span>, <span class="st">"pubDate"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="fetch-output-formats" class="section level3">
<h3 class="hasAnchor">
<a href="#fetch-output-formats" class="anchor"></a>Fetch output formats</h3>
<p>All of the results of queries above have used the default output format of “list”, where the xml that is returned from the query is transformed to an R-friendly list as shown earlier.</p>
<p>If we instead specify that the output format is “file”, a path is returned which we can read in or do something else with:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">res</span>
<span class="co">#&gt; [1] "/tmp/Rtmpf3ZFDa/file13cb810cbc6cb.xml"</span></code></pre></div>
<p>If we specify the format to be “xml”, then the raw xml is read into R using the xml2 package.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, format <span class="op">=</span> <span class="st">"xml"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;rss version="2.0" xmlns:emm="http://emm.jrc.it" xmlns:iso="http://www.iso.org/3166" xmlns:gphin="http://gphin.canada.ca"&gt;</span>
<span class="co">#&gt; [1] &lt;channel&gt;\n  &lt;title/&gt;\n  &lt;pubDate&gt;Sat, 12 Sep 2020 21:34:33 UTC&lt;/pubDate&gt;\n  &lt; ...```</span></code></pre></div>
<p>Note that we can convert this to our list format with the following:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_xml_to_list.html">fq_xml_to_list</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></code></pre></div>
</div>
<div id="converting-to-data-frame" class="section level3">
<h3 class="hasAnchor">
<a href="#converting-to-data-frame" class="anchor"></a>Converting to data frame</h3>
<p>There is also a function, <code><a href="../reference/fq_list_to_df.html">fq_list_to_df()</a></code>, to convert fetch results to a data frame. Note that in general, a lot of information can be lost when doing this, such as attributes or entries that have more than one element.</p>
<p>Columns “title” and “description” often have two elements with the second being the English translation. Because of this, columns “title”, “title_en”, “description”, and “description_en” are created to preserve this. Columns “entity”, “category”, “fullgeo” usually have more than one entry for each document and as such are added to the data frame as “list columns”.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">res_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_list_to_df.html">fq_list_to_df</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>

<span class="va">res_df</span>                                                                          
<span class="co">#&gt;# A tibble: 10 x 17</span>
<span class="co">#&gt;   title title_en link  description description_en contentType pubDate source</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt; </span>
<span class="co">#&gt; 1 Dipl… "Diplom… http… "Dans sa r… In the headin… text/html   2020-0… Emmne…</span>
<span class="co">#&gt; 2 Séné… "Senega… http… "L’avocat … The senegales… text/html   2020-0… Emmne…</span>
<span class="co">#&gt; 3 La q… "Quaran… http… "Pour évit… To avoid this… text/html   2020-0… Emmne…</span>
<span class="co">#&gt; 4 Son … "His So… http… "Le consei… The national … text/html   2020-0… Emmne…</span>
<span class="co">#&gt; 5 Covi… "Covid … http… ".\n\n#Aut… . # other cou… text/html   2020-0… Emmne…</span>
<span class="co">#&gt; 6 Pers… "Africa… http… "#Autres p… # other count… text/html   2020-0… Emmne…</span>
<span class="co">#&gt; 7 Coro… "Corona… http… "Le corona… The Coronavir… text/html   2020-0… Emmne…</span>
<span class="co">#&gt; 8 اليو… "اليونا… http… "."         .              text/html   2020-0… cairo…</span>
<span class="co">#&gt; 9 ترام… "ترامب … http… "."         .              text/html   2020-0… cairo…</span>
<span class="co">#&gt;10 Colo… "Colomb… http… "MADRID, 9… Madrid, 9 Sep… text/html   2020-0… europ…</span>
<span class="co">#&gt;# … with 9 more variables: language &lt;chr&gt;, guid &lt;chr&gt;, category &lt;list&gt;,</span>
<span class="co">#&gt;#   favicon &lt;chr&gt;, entity &lt;list&gt;, georss &lt;chr&gt;, fullgeo &lt;list&gt;, tonality &lt;chr&gt;,</span>
<span class="co">#&gt;#   text &lt;chr&gt;</span></code></pre></div>
<p>A function <code><a href="../reference/fq_write_docs_csv.html">fq_write_docs_csv()</a></code> also exists that will flatten the list column variables into strings and write the result to a csv file:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_write_docs_csv.html">fq_write_docs_csv</a></span><span class="op">(</span><span class="va">res_df</span>, path <span class="op">=</span> <span class="st">"/tmp/tmp.csv"</span><span class="op">)</span></code></pre></div>
</div>
<div id="fetching-to-disk" class="section level3">
<h3 class="hasAnchor">
<a href="#fetching-to-disk" class="anchor"></a>Fetching to disk</h3>
<p>In the previous fetch examples, the return object <code>docs</code> has been a list format of the document content of the query.</p>
<p>In a many cases we may wish to do a bulk download of many articles. If we specify a <code>path</code> argument to <code><a href="../reference/fq_query_fetch.html">fq_query_fetch()</a></code>, the results will be written in batches to the specified directory.</p>
<p>When running a potentially large query, it is good to first run it with <code>max = 0</code> so that no documents are returned. Queries that may involve a large number of documents but do not return any documents can run fairly quickly, and we can examine the results to find out how many documents match the query parameters and whether it would be a good idea to try to download them.</p>
<p>For example, with a query similar to what we specified earlier, suppose we want to get all documents in the last 5 days that are in German and have the “CoronavirusInfection” category.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_language.html">fq_filter_language</a></span><span class="op">(</span><span class="st">"de"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_sort_by.html">fq_sort_by</a></span><span class="op">(</span><span class="st">"pubdate"</span>, asc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="../reference/fq_n_docs.html">fq_n_docs</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="co">#&gt; [1] 14032</span></code></pre></div>
<p>We see that there are about 14k documents, which is not a lot to try to download.</p>
<p>Now, to get all of these documents with pagination, we can set <code>max = -1</code> and provide a directory to write the output to:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>

<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, format <span class="op">=</span> <span class="st">"file"</span>, path <span class="op">=</span> <span class="va">tf</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_language.html">fq_filter_language</a></span><span class="op">(</span><span class="st">"de"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># fq_select_fields("text") %&gt;%</span>
  <span class="fu"><a href="../reference/fq_sort_by.html">fq_sort_by</a></span><span class="op">(</span><span class="st">"pubdate"</span>, asc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 10000 documents fetched (71%)...</span>
<span class="co">#&gt; 14032 documents fetched (100%)...</span>

<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">tf</span><span class="op">)</span>
<span class="co">#&gt; [1] "out0001.xml" "out0002.xml"</span></code></pre></div>
<p>The ~14k documents were downloaded over two files located in the output directory we specified.</p>
<p>Note that since 14k documents isn’t that large, we may want to read them all into memory in R in the more convenient list format:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">tf</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fu">xml2</span><span class="fu">::</span><span class="va"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_xml</a></span><span class="op">)</span>
<span class="va">docs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">xml</span>, <span class="va">xml_to_list</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">docs</span><span class="op">)</span>
<span class="co">#&gt; [1] 14032</span></code></pre></div>
</div>
</div>
<div id="facet-gueries" class="section level2">
<h2 class="hasAnchor">
<a href="#facet-gueries" class="anchor"></a>Facet gueries</h2>
<p>Facet queries are constructed by doing the following:</p>
<ul>
<li>Initiate a facet query using <code><a href="../reference/fq_query_facet.html">fq_query_facet()</a></code>
</li>
<li>Optionally specify filters to apply to the documents</li>
<li>Build on this query by specifying <em>one</em> of:
<ul>
<li>Fields to facet on using <code><a href="../reference/fq_facet_by.html">fq_facet_by()</a></code>
</li>
<li>Date binning using <code><a href="../reference/fq_facet_date_range.html">fq_facet_date_range()</a></code>
</li>
</ul>
</li>
</ul>
<div id="initiating-a-guery" class="section level3">
<h3 class="hasAnchor">
<a href="#initiating-a-guery" class="anchor"></a>Initiating a guery</h3>
<p>To initiate a facet query, we use the function <code><a href="../reference/fq_query_facet.html">fq_query_facet()</a></code>, and pass it our connection object.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_facet.html">fq_query_facet</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></code></pre></div>
<p>Similarly to fetch queries, we can call <code><a href="../reference/fq_get_query.html">fq_get_query()</a></code> or <code><a href="../reference/fq_run.html">fq_run()</a></code> to print the query string or run the query.</p>
</div>
<div id="faceting-by-fields" class="section level3">
<h3 class="hasAnchor">
<a href="#faceting-by-fields" class="anchor"></a>Faceting by fields</h3>
<p>Suppose we want to tabulate the frequency of all of the categories in the documents over the last two days. We can do this by adding <code><a href="../reference/fq_facet_by.html">fq_facet_by()</a></code> to our query, specifying the field name “category”.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_query_facet.html">fq_query_facet</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_facet_by.html">fq_facet_by</a></span><span class="op">(</span><span class="st">"category"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_get_query.html">fq_get_query</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "op=search&amp;q=*:*&amp;rows=0&amp;facet=true&amp;native=true&amp;facet.field=category&amp;facet.limit=-1&amp;facet.sort=count&amp;facet.mincount=0&amp;facet.offset=0&amp;fq=pubdate%3A%5B2020-09-10T00%3A00%3A00Z%20TO%20%2A%5D"</span></code></pre></div>
<p>Here we see the facet query string that is constructed by this query specification.</p>
<p>To run the query, we use <code><a href="../reference/fq_run.html">fq_run()</a></code> as we did with fetch queries. Here, we additionaly specify in <code><a href="../reference/fq_facet_by.html">fq_facet_by()</a></code> that we only want the top 10 categories.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_facet.html">fq_query_facet</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_facet_by.html">fq_facet_by</a></span><span class="op">(</span><span class="st">"category"</span>, limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;    category                            n</span>
<span class="co">#&gt;    &lt;chr&gt;                           &lt;dbl&gt;</span>
<span class="co">#&gt;  1 fifa2018participatingcountries 458411</span>
<span class="co">#&gt;  2 euro                           452639</span>
<span class="co">#&gt;  3 coronavirusinfection           209279</span>
<span class="co">#&gt;  4 paho                           208024</span>
<span class="co">#&gt;  5 wpro                           115488</span>
<span class="co">#&gt;  6 radnucnonelist                 109946</span>
<span class="co">#&gt;  7 emro                            94203</span>
<span class="co">#&gt;  8 usa                             91441</span>
<span class="co">#&gt;  9 italy                           61976</span>
<span class="co">#&gt; 10 implantrisks                    51553</span></code></pre></div>
<p>Different from fetch queries, facet queries always return a data frame.</p>
<p>It is possible to facet on up to two fields.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_facet.html">fq_query_facet</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_facet_by.html">fq_facet_by</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"category"</span>, <span class="st">"language"</span><span class="op">)</span>, limit <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">res</span>
<span class="co">#&gt; # A tibble: 4,403 x 3</span>
<span class="co">#&gt;    category language     n</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1 euro     en       55307</span>
<span class="co">#&gt;  2 euro     it       47138</span>
<span class="co">#&gt;  3 euro     es       39303</span>
<span class="co">#&gt;  4 euro     el       35447</span>
<span class="co">#&gt;  5 euro     ru       33457</span>
<span class="co">#&gt;  6 euro     de       32450</span>
<span class="co">#&gt;  7 euro     fr       21507</span>
<span class="co">#&gt;  8 euro     tr       14694</span>
<span class="co">#&gt;  9 euro     pt       13721</span>
<span class="co">#&gt; 10 euro     ar       13421</span>
<span class="co">#&gt; # … with 4,393 more rows</span></code></pre></div>
<p>To see what fields are avilable to facet on:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_facetable_fields.html">fq_facetable_fields</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "language"      "category"      "country"       "source"       </span>
<span class="co">#&gt; [5] "quotewho"      "quotecategory" "duplicate"</span></code></pre></div>
<div id="updating-facetable-fields" class="section level4">
<h4 class="hasAnchor">
<a href="#updating-facetable-fields" class="anchor"></a>Updating facetable fields</h4>
<p>If you are working with an updated database and you believe that additional fields are facetable, you can update the package source code in R/query_facet.R. <code><a href="../reference/fq_facetable_fields.html">fq_facetable_fields()</a></code> simply returns a vector of field names. You can add field names to this vector. Note that you should experiment with faceting on any additional fields to ensure that the queries work before adding them to this list.</p>
</div>
</div>
<div id="faceting-by-dates" class="section level3">
<h3 class="hasAnchor">
<a href="#faceting-by-dates" class="anchor"></a>Faceting by dates</h3>
<p>A faceting function is available to specify faceting on dates, <code><a href="../reference/fq_facet_date_range.html">fq_facet_date_range()</a></code>.</p>
<p>The main parameters for this function are:</p>
<ul>
<li>
<code>field</code>: either “pubdate” (default) or “indexdate”</li>
<li>
<code>start</code>, <code>end</code>: the start and end dates to facet over, specified as “Date” objects</li>
<li>
<code>gap</code>: The bin size to facet over. This is specified using the <code><a href="../reference/fq_range_gap.html">fq_range_gap()</a></code> function as will be illustrated the examples below.</li>
</ul>
<p>To facet daily by publication date for all “CoronavirusInfection” articles over the past 20 days:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_facet.html">fq_query_facet</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"coronavirusinfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_facet_date_range.html">fq_facet_date_range</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">20</span>,
    end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
    gap <span class="op">=</span> <span class="fu"><a href="../reference/fq_range_gap.html">fq_range_gap</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"DAY"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 2</span>
<span class="co">#&gt;    pubdate                 n</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2020-08-23 00:00:00 54439</span>
<span class="co">#&gt;  2 2020-08-24 00:00:00 79749</span>
<span class="co">#&gt;  3 2020-08-25 00:00:00 87616</span>
<span class="co">#&gt;  4 2020-08-26 00:00:00 82739</span>
<span class="co">#&gt;  5 2020-08-27 00:00:00 82490</span>
<span class="co">#&gt;  6 2020-08-28 00:00:00 79061</span>
<span class="co">#&gt;  7 2020-08-29 00:00:00 54291</span>
<span class="co">#&gt;  8 2020-08-30 00:00:00 50336</span>
<span class="co">#&gt;  9 2020-08-31 00:00:00 76238</span>
<span class="co">#&gt; 10 2020-09-01 00:00:00 84864</span>
<span class="co">#&gt; 11 2020-09-02 00:00:00 86083</span>
<span class="co">#&gt; 12 2020-09-03 00:00:00 85665</span>
<span class="co">#&gt; 13 2020-09-04 00:00:00 81934</span>
<span class="co">#&gt; 14 2020-09-05 00:00:00 57294</span>
<span class="co">#&gt; 15 2020-09-06 00:00:00 50430</span>
<span class="co">#&gt; 16 2020-09-07 00:00:00 77083</span>
<span class="co">#&gt; 17 2020-09-08 00:00:00 85925</span>
<span class="co">#&gt; 18 2020-09-09 00:00:00 90019</span>
<span class="co">#&gt; 19 2020-09-10 00:00:00 75486</span>
<span class="co">#&gt; 20 2020-09-11 00:00:00 76962</span></code></pre></div>
<p>The <code><a href="../reference/fq_range_gap.html">fq_range_gap()</a></code> function takes two parameters. The first is the number of time units the facet window gap should be and the second is the time unit, which is one of “DAY” (default), “MINUTE”, “HOUR”, “WEEK”, “MONTH”, or “YEAR”.</p>
<p>Here we run the same facet but hourly:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_facet.html">fq_query_facet</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"coronavirusinfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_facet_date_range.html">fq_facet_date_range</a></span><span class="op">(</span>
    start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">20</span>,
    end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
    gap <span class="op">=</span> <span class="fu"><a href="../reference/fq_range_gap.html">fq_range_gap</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"HOUR"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 480 x 2</span>
<span class="co">#&gt;    pubdate                 n</span>
<span class="co">#&gt;    &lt;dttm&gt;              &lt;dbl&gt;</span>
<span class="co">#&gt;  1 2020-08-23 00:00:00  1043</span>
<span class="co">#&gt;  2 2020-08-23 00:00:00  1131</span>
<span class="co">#&gt;  3 2020-08-23 00:00:00  1186</span>
<span class="co">#&gt;  4 2020-08-23 00:00:00  1088</span>
<span class="co">#&gt;  5 2020-08-23 00:00:00  2566</span>
<span class="co">#&gt;  6 2020-08-23 00:00:00  2276</span>
<span class="co">#&gt;  7 2020-08-23 00:00:00  2344</span>
<span class="co">#&gt;  8 2020-08-23 00:00:00  2075</span>
<span class="co">#&gt;  9 2020-08-23 00:00:00  2915</span>
<span class="co">#&gt; 10 2020-08-23 00:00:00  2491</span>
<span class="co">#&gt; # … with 470 more rows</span></code></pre></div>
</div>
</div>
<div id="string-queries" class="section level2">
<h2 class="hasAnchor">
<a href="#string-queries" class="anchor"></a>String queries</h2>
<p>There are many ways queries can be constructed with Solr/Finder. The functions for fetching and faceting provided above are meant to cover the vast majority of use cases, but their simplified API might not allow for some very special cases. If one is very familiar with Finder/Solr and wants to use this package to execute their own custom queries, there is a simple mechanism for doing this:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fq_query_str() allows you to run a query that you have already constructed a query string for</span>
<span class="co"># default is to return a list</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_str.html">fq_query_str</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"op=search&amp;q=*:*"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># to return in xml format</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_str.html">fq_query_str</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"op=search&amp;q=*:*"</span>, format <span class="op">=</span> <span class="st">"xml"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">res</span>
<span class="co">#&gt; {xml_document}</span>
<span class="co">#&gt; &lt;rss version="2.0" xmlns:emm="http://emm.jrc.it" xmlns:iso="http://www.iso.org/3166" xmlns:gphin="http://gphin.canada.ca"&gt;</span>
<span class="co">#&gt; [1] &lt;channel&gt;\n  &lt;title/&gt;\n  &lt;pubDate&gt;Wed, 17 Mar 2021 07 ...</span></code></pre></div>
<p>A general practice for using <code><a href="../reference/fq_query_str.html">fq_query_str()</a></code> might be to start by using the more basic functions provided by this package and call <code><a href="../reference/fq_get_query.html">fq_get_query()</a></code> to get a basic query string to work with, which you can then customize as needed.</p>
<p>Note that when using <code><a href="../reference/fq_query_str.html">fq_query_str()</a></code>, at query execution, we do not know whether the query is for fetching, faceting, or something else. Therefore we don’t know how to handle the output. For example, with fetch queries, the query execution has convenient pagination and output formatting functionality built in. For faceting queries, an otherwise unpleasant transformation from xml/list format to a data frame is done. To take advantage of this functionality with <code><a href="../reference/fq_query_str.html">fq_query_str()</a></code>, there is an argument, <code>type</code>, that you can specify that will allow you to inform the query execution that it is a “fetch” or “facet” query (default is “unknown”).</p>
<p>For example, suppose we have the following query string we want to run:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_str.html">fq_query_str</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"op=search&amp;q=+( 
(
+{!babel t=\"(health healthcare \\\"health care\\\" \\\"health-care\\\" medical)\"}
+{!babel t=\"(specialist* provider* professional* practitioner* doctor* worker* personnel staff)\"}
)
{!babel t=\"(physician* \\\"general practitioner\\\" therapist* nurse* midwife* caregiver* \\\"care provider\\\" gastroenterologist* surgeon* dentist* psychiatrist* pharmacist* ophthalmologist* cardiologist* anaesthesiologist* anesthesiologist* dermatologist* endocrinologist* geriatrician* haematologist*  hematologist* nephrologist* neurologist* oncologist* otolaryngologist* pulmonologist* paediatrician* pediatrician* radiologist* urologist*)\"}
) 
+pubdate:[2021-01-01T00:00:00Z TO 2021-01-01T23:59:59Z]
+category:CoronavirusInfection
+language:en
+duplicate:false&amp;rows=100"</span>, type <span class="op">=</span> <span class="st">"fetch"</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_select_fields.html">fq_select_fields</a></span><span class="op">(</span><span class="st">"pubDate"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Since we have specified <code>type = "fetch"</code>, it is treated as a fetch query and functions like <code><a href="../reference/fq_select_fields.html">fq_select_fields()</a></code> work in association with the query string.</p>
<p>Note that this particular custom query string could actually be written without the use of <code><a href="../reference/fq_query_str.html">fq_query_str()</a></code>:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_fetch.html">fq_query_fetch</a></span><span class="op">(</span><span class="va">con</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_q.html">fq_q</a></span><span class="op">(</span><span class="st">"+( 
(
+{!babel t=\"(health healthcare \\\"health care\\\" \\\"health-care\\\" medical)\"}
+{!babel t=\"(specialist* provider* professional* practitioner* doctor* worker* personnel staff)\"}
)
{!babel t=\"(physician* \\\"general practitioner\\\" therapist* nurse* midwife* caregiver* \\\"care provider\\\" gastroenterologist* surgeon* dentist* psychiatrist* pharmacist* ophthalmologist* cardiologist* anaesthesiologist* anesthesiologist* dermatologist* endocrinologist* geriatrician* haematologist*  hematologist* nephrologist* neurologist* oncologist* otolaryngologist* pulmonologist* paediatrician* pediatrician* radiologist* urologist*)\"}
)"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2021-01-01 00:00:00"</span><span class="op">)</span>,
    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="st">"2021-01-01 23:59:59"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_category.html">fq_filter_category</a></span><span class="op">(</span><span class="st">"CoronavirusInfection"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_language.html">fq_filter_language</a></span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_duplicate.html">fq_filter_duplicate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_select_fields.html">fq_select_fields</a></span><span class="op">(</span><span class="st">"pubDate"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Also note that we can pass the string to <code><a href="../reference/fq_query_str.html">fq_query_str()</a></code> URL-encoded:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_str.html">fq_query_str</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"op=search&amp;q=%2B(%20%0A(%0A%2B%7B!babel%20t%3D%22(health%20healthcare%20%5C%22health%20care%5C%22%20%5C%22health-care%5C%22%20medical)%22%7D%0A%2B%7B!babel%20t%3D%22(specialist*%20provider*%20professional*%20practitioner*%20doctor*%20worker*%20personnel%20staff)%22%7D%0A)%0A%7B!babel%20t%3D%22(physician*%20%5C%22general%20practitioner%5C%22%20therapist*%20nurse*%20midwife*%20caregiver*%20%5C%22care%20provider%5C%22%20gastroenterologist*%20surgeon*%20dentist*%20psychiatrist*%20pharmacist*%20ophthalmologist*%20cardiologist*%20anaesthesiologist*%20anesthesiologist*%20dermatologist*%20endocrinologist*%20geriatrician*%20haematologist*%20%20hematologist*%20nephrologist*%20neurologist*%20oncologist*%20otolaryngologist*%20pulmonologist*%20paediatrician*%20pediatrician*%20radiologist*%20urologist*)%22%7D%0A)%20%0A%2Bpubdate%3A%5B2021-01-01T00%3A00%3A00Z%20TO%202021-01-01T23%3A59%3A59Z%5D%0A%2Bcategory%3ACoronavirusInfection%0A%2Blanguage%3Aen%0A%2Bduplicate%3Afalse&amp;rows=2"</span>, type <span class="op">=</span> <span class="st">"fetch"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_select_fields.html">fq_select_fields</a></span><span class="op">(</span><span class="st">"pubDate"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Also, note that features like pagination work with <code><a href="../reference/fq_query_str.html">fq_query_str()</a></code>:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_str.html">fq_query_str</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"op=search&amp;q=+( 
(
+{!babel t=\"(health healthcare \\\"health care\\\" \\\"health-care\\\" medical)\"}
+{!babel t=\"(specialist* provider* professional* practitioner* doctor* worker* personnel staff)\"}
)
{!babel t=\"(physician* \\\"general practitioner\\\" therapist* nurse* midwife* caregiver* \\\"care provider\\\" gastroenterologist* surgeon* dentist* psychiatrist* pharmacist* ophthalmologist* cardiologist* anaesthesiologist* anesthesiologist* dermatologist* endocrinologist* geriatrician* haematologist*  hematologist* nephrologist* neurologist* oncologist* otolaryngologist* pulmonologist* paediatrician* pediatrician* radiologist* urologist*)\"}
) 
+pubdate:[2021-01-01T00:00:00Z TO 2021-01-01T23:59:59Z]
+category:CoronavirusInfection
+language:en
+duplicate:false&amp;rows=100"</span>,
    type <span class="op">=</span> <span class="st">"fetch"</span>, max <span class="op">=</span> <span class="fl">100</span>, size <span class="op">=</span> <span class="fl">10</span>, path <span class="op">=</span> <span class="va">pth</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_select_fields.html">fq_select_fields</a></span><span class="op">(</span><span class="st">"pubDate"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 10 documents fetched (10%)...</span>
<span class="co">#&gt; 20 documents fetched (20%)...</span>
<span class="co">#&gt; 30 documents fetched (30%)...</span>
<span class="co">#&gt; 40 documents fetched (40%)...</span>
<span class="co">#&gt; 50 documents fetched (50%)...</span>
<span class="co">#&gt; 60 documents fetched (60%)...</span>
<span class="co">#&gt; 70 documents fetched (70%)...</span>
<span class="co">#&gt; 80 documents fetched (80%)...</span>
<span class="co">#&gt; 90 documents fetched (90%)...</span>
<span class="co">#&gt; 100 documents fetched (100%)...</span></code></pre></div>
<p>Finally, an example with <code>type="facet"</code>.</p>
<p>From a previous example:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/fq_query_facet.html">fq_query_facet</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_filter_pubdate.html">fq_filter_pubdate</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_facet_by.html">fq_facet_by</a></span><span class="op">(</span><span class="st">"category"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_get_query.html">fq_get_query</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "op=search&amp;q=*:*&amp;rows=0&amp;facet=true&amp;native=true&amp;facet.field=category&amp;facet.limit=-1&amp;facet.sort=count&amp;facet.mincount=0&amp;facet.offset=0&amp;fq=pubdate%3A%5B2020-09-10T00%3A00%3A00Z%20TO%20%2A%5D"</span></code></pre></div>
<p>We can run this query with the <code><a href="../reference/fq_query_str.html">fq_query_str()</a></code> with the following:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_str.html">fq_query_str</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"op=search&amp;q=*:*&amp;rows=0&amp;facet=true&amp;native=true&amp;facet.field=category&amp;facet.limit=-1&amp;facet.sort=count&amp;facet.mincount=0&amp;facet.offset=0&amp;fq=pubdate%3A%5B2020-09-10T00%3A00%3A00Z%20TO%20%2A%5D"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>However, note that the result is a messy list:</p>
<p>If we update this to specify <code>type="facet"</code>, we get the desired result:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fq_query_str.html">fq_query_str</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"op=search&amp;q=*:*&amp;rows=0&amp;facet=true&amp;native=true&amp;facet.field=category&amp;facet.limit=-1&amp;facet.sort=count&amp;facet.mincount=0&amp;facet.offset=0&amp;fq=pubdate%3A%5B2020-09-10T00%3A00%3A00Z%20TO%20%2A%5D"</span>, type <span class="op">=</span> <span class="st">"facet"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/fq_run.html">fq_run</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;    category                            n</span>
<span class="co">#&gt;    &lt;chr&gt;                           &lt;dbl&gt;</span>
<span class="co">#&gt;  1 fifa2018participatingcountries 458411</span>
<span class="co">#&gt;  2 euro                           452639</span>
<span class="co">#&gt;  3 coronavirusinfection           209279</span>
<span class="co">#&gt;  4 paho                           208024</span>
<span class="co">#&gt;  5 wpro                           115488</span>
<span class="co">#&gt;  6 radnucnonelist                 109946</span>
<span class="co">#&gt;  7 emro                            94203</span>
<span class="co">#&gt;  8 usa                             91441</span>
<span class="co">#&gt;  9 italy                           61976</span>
<span class="co">#&gt; 10 implantrisks                    51553</span></code></pre></div>
</div>
</div>
<div id="limitations" class="section level1">
<h1 class="hasAnchor">
<a href="#limitations" class="anchor"></a>Limitations</h1>
<p>This package is experimental and has not undergone rigorous testing to verify the correctness of the constructed queries. Use at your own risk.</p>
<p>The package has been written to cover a large number of immediate use cases. However, there are many additional features and parameters of SOLR/Finder that could be exposed through this interface in the future.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Ryan Hafen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
